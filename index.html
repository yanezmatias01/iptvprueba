<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Mi IPTV Web</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
  body{
    margin:0; font-family: Arial, sans-serif;
    background:#111; color:#fff;
    display:flex; height:100vh;
  }

  /* SIDEBAR */
  #sidebar{
    width:300px; background:#1c1c1c;
    border-right:1px solid #333;
    display:flex; flex-direction:column;
    overflow:hidden;
  }

  #topControls{
    padding:12px;
    border-bottom:1px solid #2a2a2a;
  }

  #search{
    width:100%;
    box-sizing:border-box;
    padding:10px 12px;
    border-radius:8px;
    border:1px solid #333;
    outline:none;
    background:#111;
    color:#fff;
  }

  #cats{
    margin-top:10px;
    display:flex;
    flex-wrap:wrap;
    gap:8px;
  }

  .chip{
    padding:7px 10px;
    border-radius:999px;
    border:1px solid #333;
    background:#151515;
    cursor:pointer;
    user-select:none;
    font-size:13px;
  }

  .chip.active{
    background:#0078ff;
    border-color:#0078ff;
  }

  #channels{
    overflow-y:auto;
    flex:1;
  }

  .channel{
    padding:12px;
    cursor:pointer;
    border-bottom:1px solid #2a2a2a;
    user-select:none;
  }
  .channel:hover{ background:#333; }
  .channel.active{ background:#0078ff; }

  /* PLAYER */
  #playerWrap{
    position:relative; flex:1; background:#000;
  }
  iframe{
    width:100%; height:100%;
    border:none; background:#000;
  }

  /* Anti primer click */
  #clickBlocker{
    position:absolute; inset:0;
    z-index:10;
    background:rgba(0,0,0,0.55);
    cursor:pointer;
    display:none;
  }
  #hint{
    position:absolute;
    z-index:11;
    left:50%; top:50%;
    transform:translate(-50%,-50%);
    background:rgba(0,0,0,0.7);
    padding:16px 22px;
    border-radius:10px;
    font-size:16px;
    text-align:center;
    pointer-events:none;
    display:none;
  }
</style>
</head>

<body>

<div id="sidebar">
  <div id="topControls">
    <input id="search" type="text" placeholder="Buscar canal..." />
    <div id="cats"></div>
  </div>
  <div id="channels"></div>
</div>

<div id="playerWrap">
  <div id="clickBlocker"></div>
  <div id="hint">Haz clic una vez para iniciar el canal</div>

  <iframe
    id="iframePlayer"
    src=""
    loading="lazy"
    allow="autoplay; fullscreen; picture-in-picture"
    allowfullscreen>
  </iframe>
</div>

<script>
/**
 * IMPORTANTE:
 * - Aquí NO “busco” streams. Solo organizo tu lista.
 * - Puedes crear categorías (por ejemplo: "Chile Fútbol") y luego
 *   tú agregas los IDs/canales que correspondan en tu fuente.
 */

// ====== CANALES (edítalos como quieras) ======
const channels = [
  // Chile Fútbol (ejemplo de categoría)
  { id: 302, name: "Canal 302", category: "Chile Fútbol" },

  // Deportes internacionales
  { id: 491, name: "beIN Sports Australia 1", category: "Deportes" },

  // Kids
  { id: 648, name: "Boomerang", category: "Kids" },

  // Otros
  { id: 401, name: "TVO CA", category: "Otros" }
];

// ====== UI refs ======
const catsWrap = document.getElementById("cats");
const list = document.getElementById("channels");
const search = document.getElementById("search");
const iframe = document.getElementById("iframePlayer");
const blocker = document.getElementById("clickBlocker");
const hint = document.getElementById("hint");

// ====== State ======
let activeCategory = "Todo";
let activeChannelId = null;

// ====== Helpers ======
function uniqueCategories(items){
  const set = new Set(items.map(x => x.category || "Otros"));
  return ["Todo", ...Array.from(set).sort((a,b)=>a.localeCompare(b))];
}

function matchesFilters(ch){
  const q = (search.value || "").trim().toLowerCase();
  const inCat = (activeCategory === "Todo") || ((ch.category || "Otros") === activeCategory);
  const inSearch = !q || ch.name.toLowerCase().includes(q);
  return inCat && inSearch;
}

function renderCategories(){
  catsWrap.innerHTML = "";
  const cats = uniqueCategories(channels);

  cats.forEach(cat => {
    const chip = document.createElement("div");
    chip.className = "chip" + (cat === activeCategory ? " active" : "");
    chip.textContent = cat;
    chip.onclick = () => {
      activeCategory = cat;
      renderCategories();
      renderChannelList();
    };
    catsWrap.appendChild(chip);
  });
}

function loadChannel(ch){
  // activar overlay anti-popup
  blocker.style.display = "block";
  hint.style.display = "block";

  activeChannelId = ch.id;
  renderChannelList();

  iframe.removeAttribute("src");
  setTimeout(() => {
    iframe.src = `https://dlhd.link/stream/stream-${ch.id}.php`;
  }, 200);
}

function renderChannelList(){
  list.innerHTML = "";

  const filtered = channels.filter(matchesFilters);

  filtered.forEach(ch => {
    const div = document.createElement("div");
    div.className = "channel" + (ch.id === activeChannelId ? " active" : "");
    div.textContent = ch.name;
    div.onclick = () => loadChannel(ch);
    list.appendChild(div);
  });

  // si no hay canal activo o ya no está en filtro, selecciona el primero filtrado
  if ((!activeChannelId || !filtered.some(x => x.id === activeChannelId)) && filtered.length){
    // no autoload para evitar popups al cargar; deja que el usuario haga click si quieres
    // Si quieres autoload, descomenta:
    // loadChannel(filtered[0]);
  }
}

// overlay: primer click
blocker.onclick = () => {
  blocker.style.display = "none";
  hint.style.display = "none";
};

// re-render al buscar
search.addEventListener("input", () => renderChannelList());

// init
renderCategories();
renderChannelList();
</script>

</body>
</html>
